# Makefile.in for olmar
#
#  Copyright 2006-2007 Hendrik Tews, All rights reserved. #
#  See file license.txt for terms of use                  #
###########################################################

# Values of configure variables for illustration only!
# Don't change them here, they are contained in every 
# subdir makefile as well! To change them either run configure
# until you see the desired values here or invoke make with 
# a variable assignment ``make "CXX=mygcc" ... ''

ELSA_BASE_BASE:=@ELSA_BASE_BASE@
MEMCHECK:=@MEMCHECK@
CXX:=@CXX@
CCFLAGS:=@CCFLAGS@
OCC:=@OCC@
OCCC:=@OCCC@
OCOPT:=@OCOPT@
OCP4O:=@OCP4O@
OC_OBJ_EXT:=@OC_OBJ_EXT@
OC_LIB_EXT:=@OC_LIB_EXT@
OC_NATIVE:=@OC_NATIVE@
OCDIR:=@OCDIR@
OLMARSUBDIRS:=@OLMARSUBDIRS@

TODISTCLEAN :=
TOCLEAN :=


# simply redirect all goals into the subdirectories

SUBDIRS := $(OLMARSUBDIRS)


.PHONY: all stage_1 stage_2 clean depend

all: stage_1 stage_2 stage_3


stage_1:
	for d in $(SUBDIRS) ; do $(MAKE) -C $$d $@; \
		if [ $$? -ne 0 ] ; then exit 1; fi; \
	done


stage_2:
	for d in $(SUBDIRS) ; do $(MAKE) -C $$d $@; \
		if [ $$? -ne 0 ] ; then exit 1; fi; \
	done


stage_3:
	for d in $(SUBDIRS) ; do $(MAKE) -C $$d $@; \
		if [ $$? -ne 0 ] ; then exit 1; fi; \
	done


clean:
	for d in $(SUBDIRS) ; do $(MAKE) -C $$d $@; \
		if [ $$? -ne 0 ] ; then exit 1; fi; \
	done
	rm -f $(TOCLEAN)


distclean:
	for d in $(SUBDIRS) ; do $(MAKE) -C $$d $@; \
		if [ $$? -ne 0 ] ; then exit 1; fi; \
	done
	rm -f $(TODISTCLEAN)


depend:
	for d in $(SUBDIRS) ; do $(MAKE) -C $$d $@; \
		if [ $$? -ne 0 ] ; then exit 1; fi; \
	done


byte:
	$(MAKE) OCDEBUG=1 all


stage1: stage_1
stage2: stage_2
stage3: stage_3

MLDISCARD := \
	oast_header_start.ml

.PHONY: TAGS
TAGS:
	otags `find . -name \*.ml -o -name \*.mli |\
		egrep -v $(MLDISCARD)`
	etags --append --members -l c++ \
		`find . -name \*.h` \
		`find . -name \*.cc` \
		`find . -name \*.cpp`


# re-create Makefile if Makefile.in has changed
TODISTCLEAN += Makefile
Makefile: Makefile.in config.status configure.pl
	./config.status -only .


