# Makefile for olmar/util
#
#  Copyright 2006-2007 Hendrik Tews, All rights reserved. #
#  See file license.txt for terms of use                  #
###########################################################

# Makefile.in
# this is the Makefile for the ocaml ast tools

# use the first goal for development, for release put it in comment and use all

# external tools
OCC := @OCC@
OCCC := @OCCC@
OCOPT := @OCOPT@

OC_OBJ_EXT := @OC_OBJ_EXT@
OC_LIB_EXT := @OC_LIB_EXT@

OC_FLAGS := -w Ae
OC_BYTE_FLAGS := -g
OCDEPOPTS := -native

OCDEBUG=0
ifeq ($(OCDEBUG),1)
  OCOPT := $(OCC) -g
  OCCC  := $(OCC) -g
  OCC   := $(OCC) -g
  OC_OBJ_EXT := cmo
  OC_LIB_EXT := cma
  OCDEPOPTS :=
endif

.PHONY: stage_1
stage_1: olmar_utils.$(OC_LIB_EXT)

stage_2:

stage_3:

# list of files to clean in 'clean' (etc.) targets
# (these get added to below)
TOCLEAN :=
TODISTCLEAN :=

# re-create Makefile if Makefile.in has changed
TODISTCLEAN += Makefile
Makefile: Makefile.in ../config.status
	(cd ..; ./config.status -only util)


#############################################################################
#####
##### gen_uplinks

OLMAR_UTILS_ML=\
	stdlib_missing.ml \
	more_string.ml \
	dense_set.ml \
	dot_graph.ml

TOCLEAN += olmar_utils.cmxa
olmar_utils.cmxa: $(OLMAR_UTILS_ML:.ml=.cmx)
	$(OCCC) $(OC_FLAGS) -o $@ -a $^

TOCLEAN += olmar_utils.cma
olmar_utils.cma: $(OLMAR_UTILS_ML:.ml=.cmo)
	$(OCC) $(OC_FLAGS) -o $@ -a $^


############################################################################
#### Misc
#### 

.PHONY: clean
clean:
	rm -f $(TOCLEAN)


.PHONY: distclean
distclean: clean
	rm -f Makefile config.status config.summary
	rm -f astmapfuns.mli


TOCLEAN += *.cmo *.cmxa *.cma *.a
%.cmo: %.ml
	$(OCC) $(OC_BYTE_FLAGS) $(OC_FLAGS) -c $<

TOCLEAN += *.cmx *.o
%.cmx: %.ml
	$(OCOPT) $(OC_FLAGS) -c $<

TOCLEAN += *.cmi
%.cmi: %.mli
	$(OCC) $(OC_FLAGS) -c $<


-include mldeps.mk

.PHONY: mldeps
depend: mldeps
mldeps:
	ocamldep $(OCDEPOPTS) *ml *mli > mldeps.mk
